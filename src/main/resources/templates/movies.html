<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies - Movie Ticket Booking System</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-film"></i> Movie Ticket Booking System</h1>
                <p>Discover amazing movies and book your tickets!</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <ul class="nav-links">
                <li><a href="/"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="/movies" class="active"><i class="fas fa-film"></i> Movies</a></li>
                <li><a href="/booking"><i class="fas fa-ticket-alt"></i> Book Tickets</a></li>
                <li><a href="/bookings"><i class="fas fa-list"></i> My Bookings</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <section class="page-header">
                <h2><i class="fas fa-film"></i> Available Movies</h2>
                <p>Choose from our collection of amazing movies</p>
            </section>

            <!-- Filters -->
            <section class="filters">
                <div class="filter-container">
                    <div class="filter-item">
                        <label for="genreFilter">Genre:</label>
                        <select id="genreFilter" onchange="filterMovies()">
                            <option value="">All Genres</option>
                            <option value="Action">Action</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Thriller">Thriller</option>
                            <option value="Comedy">Comedy</option>
                            <option value="Drama">Drama</option>
                            <option value="Horror">Horror</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="searchInput">Search:</label>
                        <input type="text" id="searchInput" placeholder="Search movies..." oninput="filterMovies()">
                    </div>
                    <div class="filter-item">
                        <button class="btn btn-secondary" onclick="clearFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </section>

            <!-- Loading State -->
            <div id="loadingMovies" class="loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> Loading movies...
            </div>

            <!-- Error State -->
            <div id="errorMovies" class="error-message" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i> Failed to load movies. Please try again.
                <button class="btn btn-primary" onclick="loadMovies()">Retry</button>
            </div>

            <!-- Movies Grid -->
            <section class="movies-section">
                <div class="movie-grid" id="moviesContainer">
                    <!-- Movies will be loaded here dynamically -->
                </div>
                
                <!-- No movies message -->
                <div id="noMovies" class="no-results" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>No movies found</h3>
                    <p>Try adjusting your search criteria</p>
                </div>
            </section>

            <!-- Movie Details Modal -->
            <div id="movieModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalMovieTitle">Movie Title</h3>
                        <button class="modal-close" onclick="closeMovieModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="movie-details">
                            <div class="movie-info">
                                <p><strong>Genre:</strong> <span id="modalMovieGenre"></span></p>
                                <p><strong>Duration:</strong> <span id="modalMovieDuration"></span> minutes</p>
                                <p><strong>Movie ID:</strong> <span id="modalMovieId"></span></p>
                            </div>
                            <div class="shows-section">
                                <h4><i class="fas fa-clock"></i> Available Shows</h4>
                                <div id="modalShowsList" class="shows-list">
                                    <!-- Shows will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="goToBooking()">
                            <i class="fas fa-ticket-alt"></i> Book Tickets
                        </button>
                        <button class="btn btn-secondary" onclick="closeMovieModal()">Close</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2025 Movie Ticket Booking System. Made with ❤️ for movie lovers!</p>
                <div class="footer-links">
                    <a href="#"><i class="fas fa-info-circle"></i> About</a>
                    <a href="#"><i class="fas fa-envelope"></i> Contact</a>
                    <a href="#"><i class="fas fa-question-circle"></i> Help</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="/js/app.js"></script>
    <script>
        let allMovies = [];
        let selectedMovie = null;

        // Load movies when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadMovies();
        });

        // Load movies from API
        async function loadMovies() {
            const loadingEl = document.getElementById('loadingMovies');
            const errorEl = document.getElementById('errorMovies');
            const containerEl = document.getElementById('moviesContainer');

            try {
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';

                const response = await fetch('/api/movies');
                if (!response.ok) throw new Error('Failed to fetch');
                
                allMovies = await response.json();
                displayMovies(allMovies);
                
            } catch (error) {
                console.error('Error loading movies:', error);
                errorEl.style.display = 'block';
                containerEl.innerHTML = '';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        // Display movies in grid
        function displayMovies(movies) {
            const container = document.getElementById('moviesContainer');
            const noMovies = document.getElementById('noMovies');

            if (movies.length === 0) {
                container.innerHTML = '';
                noMovies.style.display = 'block';
                return;
            }

            noMovies.style.display = 'none';
            container.innerHTML = movies.map(movie => `
                <div class="movie-card" onclick="openMovieModal(${movie.id})">
                    <div class="movie-poster">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">${escapeHtml(movie.title)}</h3>
                        <p class="movie-genre">
                            <i class="fas fa-tag"></i> ${escapeHtml(movie.genre)}
                        </p>
                        <p class="movie-duration">
                            <i class="fas fa-clock"></i> ${movie.duration} min
                        </p>
                        <p class="movie-shows">
                            <i class="fas fa-calendar"></i> ${movie.shows ? movie.shows.length : 0} Shows
                        </p>
                    </div>
                    <div class="movie-actions">
                        <button class="btn btn-primary btn-small">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Filter movies based on search and genre
        function filterMovies() {
            const genre = document.getElementById('genreFilter').value.toLowerCase();
            const search = document.getElementById('searchInput').value.toLowerCase();

            const filtered = allMovies.filter(movie => {
                const matchesGenre = !genre || movie.genre.toLowerCase().includes(genre);
                const matchesSearch = !search || movie.title.toLowerCase().includes(search);
                return matchesGenre && matchesSearch;
            });

            displayMovies(filtered);
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('genreFilter').value = '';
            document.getElementById('searchInput').value = '';
            displayMovies(allMovies);
        }

        // Open movie details modal
        function openMovieModal(movieId) {
            selectedMovie = allMovies.find(m => m.id === movieId);
            if (!selectedMovie) return;

            document.getElementById('modalMovieTitle').textContent = selectedMovie.title;
            document.getElementById('modalMovieGenre').textContent = selectedMovie.genre;
            document.getElementById('modalMovieDuration').textContent = selectedMovie.duration;
            document.getElementById('modalMovieId').textContent = selectedMovie.id;

            // Display shows
            const showsList = document.getElementById('modalShowsList');
            if (selectedMovie.shows && selectedMovie.shows.length > 0) {
                showsList.innerHTML = selectedMovie.shows.map(show => `
                    <div class="show-item">
                        <div class="show-info">
                            <span class="show-time">
                                <i class="fas fa-clock"></i> ${escapeHtml(show.showTime)}
                            </span>
                            <span class="show-seats">
                                <i class="fas fa-couch"></i> 
                                ${show.availableSeats ? show.availableSeats.length : show.totalSeats}/${show.totalSeats} available
                            </span>
                        </div>
                        <div class="show-id">Show ID: ${show.id}</div>
                    </div>
                `).join('');
            } else {
                showsList.innerHTML = '<p class="no-shows">No shows available for this movie.</p>';
            }

            document.getElementById('movieModal').style.display = 'block';
        }

        // Close movie modal
        function closeMovieModal() {
            document.getElementById('movieModal').style.display = 'none';
            selectedMovie = null;
        }

        // Go to booking page
        function goToBooking() {
            if (selectedMovie) {
                window.location.href = `/booking?movieId=${selectedMovie.id}`;
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('movieModal');
            if (event.target === modal) {
                closeMovieModal();
            }
        }
    </script>
</body>
</html>